function favorites_after_button_submit(t,a,e,i){}function favorites_after_initial_load(t){}jQuery(document).ready(function(){new Favorites});var Favorites=function(){var t=this,a=jQuery;t.formactions={nonce:"simplefavorites_nonce",favoritesarray:"simplefavorites_array",favorite:"simplefavorites_favorite",clearall:"simplefavorites_clear",favoritelist:"simplefavorites_list",favlist:"simplefavorites_favlist"},t.buttons=".simplefavorite-button",t.lists=".favorites-list",t.clear_buttons=".simplefavorites-clear",t.total_favorites=".simplefavorites-user-count",t.overlay=".favorites-overlay",t.favlist="[data-favlistaction]",t.ajaxurl=simple_favorites.ajaxurl,t.favorite=simple_favorites.favorite,t.favorited=simple_favorites.favorited,t.include_count=simple_favorites.includecount,t.indicate_loading=simple_favorites.indicate_loading,t.loading_text=simple_favorites.loading_text,t.loading_image_active=simple_favorites.loading_image_active,t.loading_image=simple_favorites.loading_image,t.nonce="",t.userfavorites,t.userfavlists,t.bindEvents=function(){a(document).on("click",t.buttons,function(e){e.preventDefault(),t.submitFavorite(a(this))}),a(document).on("click",t.clear_buttons,function(e){e.preventDefault(),t.clearFavorites(a(this))}),a(document).on("click",t.favlist,function(e){e.preventDefault(),t.processFavlist(a(this))}),a(document).on("change",'input[type="text"][data-listtitle][data-listid]:not([readonly])',function(t){var e=a(this).attr("data-listid"),i=a(this).nextAll('[data-listid="'+e+'"][data-favlistaction]');i.length&&(""==a(this).val()&&a(this).val(a(this).attr("data-value")),i.first().trigger("click"))}),a(document).on("click",'input[type="text"][data-listtitle][data-listid][readonly]',function(t){var e=a(this).attr("data-listid"),i=a(this).nextAll('[data-listid="'+e+'"][data-favlistaction="add"], [data-listid="'+e+'"][data-favlistaction="remove"]');i.length&&i.first().trigger("click")}),a(document).on("keydown",'input[type="text"][data-listtitle][data-listid]:not([readonly])',function(t){var e=a(this).attr("data-listid"),i=a(this).nextAll('[data-listid="'+e+'"][data-favlistaction]');i.length&&(13===t.keyCode?(i.first().trigger("click"),t.preventDefault()):27===t.keyCode&&(a(this).val(a(this).attr("data-value")),this.blur(),t.preventDefault(),t.stopImmediatePropagation()))})},t.init=function(){t.bindEvents(),t.generateNonce()},t.generateNonce=function(){a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.nonce},success:function(a){t.nonce=a.nonce,t.setUserFavorites(function(){t.updateAllButtons(),t.updateAllFavlistButtons()})}})},t.setUserFavorites=function(e){a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favoritesarray},success:function(a){t.userfavorites=a.favorites,t.userfavlists=a.favlists,t.updateAllLists(),t.updateAllButtons(),t.updateAllFavlistButtons(),t.updateClearButtons(),t.updateTotalFavorites(),e&&e(),favorites_after_initial_load(t.userfavorites)}})},t.updateAllButtons=function(e){for(var i=a(t.buttons),s=0;s<i.length;s++){var o=i[s],n=a(o).attr("data-postid"),r=a(o).attr("data-siteid"),l=(a(o).attr("data-listid"),a(o).attr("data-favoritecount")),d="",u=t.siteIndex(r),v=t.userfavorites[u]?t.userfavorites[u].posts:[];t.isFavorite(n,v)?(l=v[n].total,d=t.addFavoriteCount(t.favorited,l),a(o).addClass("active").html(d).removeClass("loading")):(d=t.addFavoriteCount(t.favorite,l),a(o).html(d),a(o).attr("disabled",!1).removeClass("active").removeClass("loading"))}e&&e()},t.updateAllFavlistButtons=function(e){for(var i=a(t.favlist),s=0;s<i.length;s++){var o=i[s],n=void 0!==a(o).attr("data-postid")?parseInt(a(o).attr("data-postid")):null,r=void 0!==a(o).attr("data-siteid")?parseInt(a(o).attr("data-siteid")):null,l=void 0!==a(o).attr("data-listid")?parseInt(a(o).attr("data-listid")):null,d=a(o).attr("data-favlistaction"),u=a(o).attr("data-favoritecount"),v="",c=t.siteIndexFavlist(r),f=t.userfavlists[c]?t.userfavlists[c].posts:[];switch(d){case"add":case"remove":null===l&&(t.isFavorite(n,f)?(u=f[n].total,v=t.addFavoriteCount(t.favorited,u),a(o).addClass("has--lists"),a(o).addClass("is--remove").removeClass("is--add"),a(o).attr("data-favlistaction","remove")):(v=t.addFavoriteCount(t.favorite,u),a(o).removeClass("has--lists"),a(o).removeClass("is--remove").addClass("is--add"),a(o).attr("data-favlistaction","add")),a(o).html(v))}a(o).attr("disabled",!1).removeClass("loading")}e&&e()},t.siteIndex=function(a){for(var e=0;e<t.userfavorites.length;e++)if(t.userfavorites[e].site_id===parseInt(a))return e},t.siteIndexFavlist=function(a){for(var e=0;e<t.userfavlists.length;e++)if(t.userfavlists[e].site_id===parseInt(a))return e},t.addFavoriteCount=function(a,e){return"1"===t.include_count&&(a+=' <span class="simplefavorite-button-count">'+e+"</span>"),a},t.submitFavorite=function(e){a(e).attr("disabled","disabled"),a(e).addClass("loading");var i=a(e).attr("data-postid"),s=a(e).attr("data-siteid"),o=parseInt(a(e).attr("data-favoritecount")),n="inactive",r="",l="";a(e).hasClass("active")?(a(e).removeClass("active"),o-1<0&&(o=1),a(e).attr("data-favoritecount",o-1),l=t.addFavoriteCount(t.favorite,o-1)):(n="active",a(e).addClass("active"),a(e).attr("data-favoritecount",o+1),l=t.addFavoriteCount(t.favorited,o+1)),r=t.addButtonLoading(l,n),a(e).html(r),a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favorite,nonce:t.nonce,postid:i,siteid:s,status:n},success:function(o){a(e).removeClass("loading"),a(e).html(l),a(e).attr("disabled",!1),t.userfavorites=o.favorites,t.updateAllLists(),t.updateAllButtons(),t.updateClearButtons(),t.updateTotalFavorites(),favorites_after_button_submit(o.favorites,i,s,n)}})},t.addButtonLoading=function(a,e){return"1"!==t.indicate_loading?a:"active"===e?t.loading_text+t.loading_image_active:t.loading_text+t.loading_image},t.updateClearButtons=function(){for(var e=0;e<a(t.clear_buttons).length;e++)for(var i=a(t.clear_buttons)[e],s=a(i).attr("data-siteid"),o=0;o<t.userfavorites.length;o++)t.userfavorites[o].site_id===parseInt(s)&&(t.objectLength(t.userfavorites[o].posts)>0?a(i).attr("disabled",!1):a(i).attr("disabled","disabled"))},t.clearFavorites=function(e){a(e).addClass("loading"),a(e).attr("disabled","disabled");var i=a(e).attr("data-siteid");a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.clearall,nonce:t.nonce,siteid:i},success:function(i){t.userfavorites=i.favorites,a(e).removeClass("loading"),t.resetCounts()}})},t.resetCounts=function(){for(var e=a(".simplefavorite-button.active.has-count"),i=0;i<e.length;i++){var s=a(e)[i],o=a(s).find(".simplefavorite-button-count"),n=a(o).text()-1;a(s).attr("data-favoritecount",n)}t.setUserFavorites(t.updateAllButtons)},t.updateAllLists=function(){for(var e=0;e<t.userfavorites.length;e++)for(var i=a(t.lists+'[data-siteid="'+t.userfavorites[e].site_id+'"]'),s=0;s<a(i).length;s++)if(""===a(i[s]).attr("data-userid")){var o=a(i)[s];t.updateSingleList(a(o),t.userfavorites[e].posts)}else t.updateUserList(i[s])},t.updateSingleList=function(e,i){t.removeInvalidListItems(e,i);var s="true"===a(e).attr("data-includebuttons"),o="true"===a(e).attr("data-includelinks"),n=a(e).find("li");a.each(n,function(t,e){var i=a(this).attr("data-postid");void 0!==i&&!1!==i||a(this).remove()}),t.objectLength(i)>0?a(e).find("[data-nofavorites]").remove():(html="<li data-nofavorites>"+a(e).attr("data-nofavoritestext")+"</li>",a(e).empty().append(html));var r=a(e).attr("data-posttype");r=r.split(","),a.each(i,function(t,i){r.length>0&&-1===a.inArray(i.post_type,r)||a(e).find("li[data-postid="+i.post_id+"]").length>0||(html='<li data-postid="'+i.post_id+'">',s&&(html+="<p>"),o&&(html+='<a href="'+i.permalink+'">'),html+=i.title,o&&(html+="</a>"),s&&(html+="</p><p>"+i.button+"</p>"),html+="</li>",a(e).append(html))})},t.updateUserList=function(e){var i=a(e).attr("data-userid"),s=a(e).attr("data-siteid"),o=a(e).attr("data-includelinks"),n=a(e).attr("data-includebuttons"),r=a(e).attr("data-posttype");a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favoritelist,nonce:t.nonce,userid:i,siteid:s,includelinks:o,includebuttons:n,posttype:r},success:function(t){a(e).replaceWith(t.list)}})},t.removeInvalidListItems=function(e,i){var s=a(e).find("li[data-postid]");a.each(s,function(e,s){var o=a(this).attr("data-postid");t.isFavorite(o,i)||a(this).remove()})},t.updateTotalFavorites=function(){for(var e=0;e<a(t.total_favorites).length;e++){for(var i=a(t.total_favorites)[e],s=parseInt(a(i).attr("data-siteid")),o=a(i).attr("data-posttypes"),n=o.split(","),r=0,l=0;l<t.userfavorites.length;l++){var d=t.userfavorites[l];d.site_id===s&&a.each(d.posts,function(){if("all"===a(i).attr("data-posttypes"))return void r++;-1!==a.inArray(this.post_type,n)&&r++})}a(i).text(r)}},t.isFavorite=function(t,e){var i=!1;return a.each(e,function(a,e){e.post_id===parseInt(t)&&(i=!0),parseInt(e.post_id)===t&&(i=!0)}),i},t.isFavlist=function(t,a){return a.listids.indexOf(parseInt(t))>-1||a.listids.indexOf(""+t)>-1},t.objectLength=function(t){var a,e=0;for(a in t)t.hasOwnProperty(a)&&e++;return e},t.processFavlist=function(e){var i=void 0!==a(e).attr("data-postid")?parseInt(a(e).attr("data-postid")):null,s=void 0!==a(e).attr("data-siteid")?parseInt(a(e).attr("data-siteid")):null,o=void 0!==a(e).attr("data-listid")?parseInt(a(e).attr("data-listid")):null,n=a(e).get(0).hasAttribute("data-reloadpage")?a(e).get(0).getAttribute("data-reloadpage"):null,r=a(e).attr("data-favlistaction"),l=a(e).parents(t.overlay).length?"true":null,d=null,u=null;if(r){if(parseInt(o)>=0){if(u=a('input[type="text"][data-listtitle][data-listid="'+parseInt(o)+'"]'),u.length){if(u=u.first(),a(u).removeClass("warning"),"edit"===r)return void(u.attr("readonly")&&(u.attr("readonly",!1),u.focus().select(),a(e).attr("data-favlistaction","update_title")));"update_title"!==r||u.attr("readonly")?"create"===r&&a(u).val()==a(u).attr("data-value")&&(a(u).focus().select(),r=null):(u.attr("readonly",!0),a(e).attr("data-favlistaction","edit"),a(u).val()==a(u).attr("data-value")&&(r=null)),d=u.val()}if("delete"===r&&!confirm("Do you really want to remove the list »"+d+"«?"))return}r&&(a(e).attr("disabled","disabled"),a(e).addClass("loading"),a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favlist,nonce:t.nonce,postid:i,siteid:s,listid:o,listname:d,favlistaction:r,within_dialogue:l},success:function(i){null!==n&&("string"==typeof n?window.location.href=n:window.location.reload()),t.userfavlists=i.favorite_data.favlists||{},i.html?t.showDialogue(i.html,function(e){a(this).removeClass("loading"),a(this).attr("disabled",!1),t.updateAllFavlistButtons()}.bind(e,i)):(a(e).removeClass("loading"),a(e).attr("disabled",!1),t.updateAllFavlistButtons())}}))}},t.showDialogue=function(a,e){var i,o,n,r=document.querySelector(t.overlay);return r?i=r.querySelector(t.overlay+"__content"):(r=document.createElement("div"),r.classList.add(t.overlay.replace(/^\./,"")),document.querySelector("body").appendChild(r),o=document.createElement("div"),o.classList.add(t.overlay.replace(/^\./,"")+"__wrapper"),r.appendChild(o),n=document.createElement("span"),n.textContent="",n.classList.add(t.overlay.replace(/^\./,"")+"__close"),n.addEventListener("click",t.hideDialogue.bind(r,e)),o.appendChild(n),i=document.createElement("div"),i.classList.add(t.overlay.replace(/^\./,"")+"__content"),o.appendChild(i),window.addEventListener("keydown",s),r.classList.add("is--active")),i&&(i.innerHTML=a),t.updateAllFavlistButtons(),r},t.hideDialogue=function(a,o){var n,r=document.querySelector(t.overlay);r&&(n=e(r),n?(r.addEventListener(n,i.bind(r),!1),r.classList.remove("is--active")):i.bind(r)(),r.classList.remove("is--active"),window.removeEventListener("keydown",s),"function"==typeof a&&a())};var e=function(t){if(t){var a={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},e=null,i={transitionDuration:"transitionduration",OTransitionDuration:"oTransitionDuration",MozTransitionDuration:"transitionduration",WebkitTransitionDuration:"webkitTransitionDuration"};for(var s in a)if(void 0!==t.style[s]){e=a[s];break}if(e)for(var o in i)if(void 0!==t.style[o]){if(parseInt(t.style[o])>0)return e;break}}return null},i=function(t){var a=this;a&&a.parentElement.removeChild(a)},s=function(e){if(27===e.keyCode){var i=document.querySelector(t.overlay+" "+t.overlay+"__close");i?a(i).trigger("click"):t.hideDialogue()}};return t.init()};