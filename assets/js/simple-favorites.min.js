function favorites_after_button_submit(t,a,i,e){}function favorites_after_initial_load(t){}jQuery(document).ready(function(){new Favorites});var Favorites=function(){var t=this,a=jQuery;t.formactions={nonce:"simplefavorites_nonce",favoritesarray:"simplefavorites_array",favorite:"simplefavorites_favorite",clearall:"simplefavorites_clear",favoritelist:"simplefavorites_list",favlist:"simplefavorites_favlist"},t.buttons=".simplefavorite-button",t.lists=".favorites-list",t.clear_buttons=".simplefavorites-clear",t.total_favorites=".simplefavorites-user-count",t.overlay=".favorites-overlay",t.favlist="[data-favlistaction]",t.ajaxurl=simple_favorites.ajaxurl,t.favorite=simple_favorites.favorite,t.favorited=simple_favorites.favorited,t.include_count=simple_favorites.includecount,t.indicate_loading=simple_favorites.indicate_loading,t.loading_text=simple_favorites.loading_text,t.loading_image_active=simple_favorites.loading_image_active,t.loading_image=simple_favorites.loading_image,t.nonce="",t.userfavorites,t.userfavlists,t.bindEvents=function(){a(document).on("click",t.buttons,function(i){i.preventDefault(),t.submitFavorite(a(this))}),a(document).on("click",t.clear_buttons,function(i){i.preventDefault(),t.clearFavorites(a(this))}),a(document).on("click",t.favlist,function(i){i.preventDefault(),t.processFavlist(a(this))}),a(document).on("change",'input[type="text"][data-listtitle][data-listid]:not([readonly])',function(t){var i=a(this).attr("data-listid"),e=a(this).nextAll('[data-listid="'+i+'"][data-favlistaction]');e.length&&(""==a(this).val()&&a(this).val(a(this).attr("data-value")),e.first().trigger("click"))}),a(document).on("click",'input[type="text"][data-listtitle][data-listid][readonly]',function(t){var i=a(this).attr("data-listid"),e=a(this).nextAll('[data-listid="'+i+'"][data-favlistaction="add"], [data-listid="'+i+'"][data-favlistaction="remove"]');e.length&&e.first().trigger("click")}),a(document).on("keydown",'input[type="text"][data-listtitle][data-listid]:not([readonly])',function(t){var i=a(this).attr("data-listid"),e=a(this).nextAll('[data-listid="'+i+'"][data-favlistaction]');e.length&&(13===t.keyCode?(e.first().trigger("click"),t.preventDefault()):27===t.keyCode&&(a(this).val(a(this).attr("data-value")),this.blur(),t.preventDefault(),t.stopImmediatePropagation()))})},t.init=function(){t.bindEvents(),t.generateNonce()},t.generateNonce=function(){a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.nonce},success:function(a){t.nonce=a.nonce,t.setUserFavorites(function(){})}})},t.setUserFavorites=function(i){a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favoritesarray},success:function(a){t.userfavorites=a.favorites,t.userfavlists=a.favlists,t.updateAllLists(),t.updateClearButtons(),t.updateTotalFavorites(),t.updateAllButtons(),t.updateAllFavlistButtons(),i&&i(),favorites_after_initial_load(t.userfavorites)}})},t.updateAllButtons=function(i){for(var e=a(t.buttons),s=0;s<e.length;s++){var o=e[s],n=a(o).attr("data-postid"),r=a(o).attr("data-siteid"),l=(a(o).attr("data-listid"),a(o).attr("data-favoritecount")),d="",u=t.siteIndex(r),v=t.userfavorites[u]?t.userfavorites[u].posts:[];t.isFavorite(n,v)?(l=v[n].total,d=t.addFavoriteCount(t.favorited,l),a(o).addClass("active").html(d).removeClass("loading")):(d=t.addFavoriteCount(t.favorite,l),a(o).html(d),a(o).attr("disabled",!1).removeClass("active").removeClass("loading"))}i&&i()},t.updateAllFavlistButtons=function(i){for(var e=a(t.favlist),s=t.siteIndexFavlist("1"),o=0;o<e.length;o++){var n=e[o],r=void 0!==a(n).attr("data-postid")?parseInt(a(n).attr("data-postid")):null,l=void 0!==a(n).attr("data-siteid")?parseInt(a(n).attr("data-siteid")):null,s=t.siteIndexFavlist("1"),d=void 0!==a(n).attr("data-listid")?parseInt(a(n).attr("data-listid")):null,u=a(n).attr("data-favlistaction"),v=a(n).attr("data-favoritecount"),c="",f=t.userfavlists[s]?t.userfavlists[s].posts:[],p=t.userfavlists[s].lists[d];switch(u){case"add":case"remove":null===d&&(t.isFavorite(r,f)?(v=f[r].total,c=t.addFavoriteCount(t.favorited,v),a(n).addClass("has--lists"),a(n).addClass("is--remove").removeClass("is--add"),a(n).attr("data-favlistaction","remove")):(c=t.addFavoriteCount(t.favorite,v),a(n).removeClass("has--lists"),a(n).removeClass("is--remove").addClass("is--add"),a(n).attr("data-favlistaction","add")),a(n).html(c))}a(n).attr("disabled",!1).removeClass("loading")}if(t.userfavlists)for(var l in t.userfavlists)for(var d in t.userfavlists[l].lists){var m,p=t.userfavlists[l].lists[d],h=OE.$doc.querySelectorAll('span[data-listid="'+d+'"][data-listtitle]'),g=h.length;for(m=0;m<g;m++)h[m].textContent=p.title;for(h=OE.$doc.querySelectorAll(".post-"+d+', [data-listid="'+d+'"][data-liststatus]'),g=h.length,m=0;m<g;m++)h[m].classList.remove("is--publish"),h[m].classList.remove("is--unpublish"),h[m].classList.add("publish"===p.status?"is--publish":"is--unpublish")}i&&i()},t.siteIndex=function(a){for(var i=0;i<t.userfavorites.length;i++)if(t.userfavorites[i].site_id===parseInt(a))return i},t.siteIndexFavlist=function(a){for(var i=0;i<t.userfavlists.length;i++)if(t.userfavlists[i].site_id===parseInt(a))return i},t.addFavoriteCount=function(a,i){return"1"===t.include_count&&(a+=' <span class="simplefavorite-button-count">'+i+"</span>"),a},t.submitFavorite=function(i){a(i).attr("disabled","disabled"),a(i).addClass("loading");var e=a(i).attr("data-postid"),s=a(i).attr("data-siteid"),o=parseInt(a(i).attr("data-favoritecount")),n="inactive",r="",l="";a(i).hasClass("active")?(a(i).removeClass("active"),o-1<0&&(o=1),a(i).attr("data-favoritecount",o-1),l=t.addFavoriteCount(t.favorite,o-1)):(n="active",a(i).addClass("active"),a(i).attr("data-favoritecount",o+1),l=t.addFavoriteCount(t.favorited,o+1)),r=t.addButtonLoading(l,n),a(i).html(r),a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favorite,nonce:t.nonce,postid:e,siteid:s,status:n},success:function(o){a(i).removeClass("loading"),a(i).html(l),a(i).attr("disabled",!1),t.userfavorites=o.favorites,t.updateAllLists(),t.updateAllButtons(),t.updateClearButtons(),t.updateTotalFavorites(),favorites_after_button_submit(o.favorites,e,s,n)}})},t.addButtonLoading=function(a,i){return"1"!==t.indicate_loading?a:"active"===i?t.loading_text+t.loading_image_active:t.loading_text+t.loading_image},t.updateClearButtons=function(){for(var i=0;i<a(t.clear_buttons).length;i++)for(var e=a(t.clear_buttons)[i],s=a(e).attr("data-siteid"),o=0;o<t.userfavorites.length;o++)t.userfavorites[o].site_id===parseInt(s)&&(t.objectLength(t.userfavorites[o].posts)>0?a(e).attr("disabled",!1):a(e).attr("disabled","disabled"))},t.clearFavorites=function(i){a(i).addClass("loading"),a(i).attr("disabled","disabled");var e=a(i).attr("data-siteid");a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.clearall,nonce:t.nonce,siteid:e},success:function(e){t.userfavorites=e.favorites,a(i).removeClass("loading"),t.resetCounts()}})},t.resetCounts=function(){for(var i=a(".simplefavorite-button.active.has-count"),e=0;e<i.length;e++){var s=a(i)[e],o=a(s).find(".simplefavorite-button-count"),n=a(o).text()-1;a(s).attr("data-favoritecount",n)}t.setUserFavorites(t.updateAllButtons)},t.updateAllLists=function(){for(var i=0;i<t.userfavorites.length;i++)for(var e=a(t.lists+'[data-siteid="'+t.userfavorites[i].site_id+'"]'),s=0;s<a(e).length;s++)if(""===a(e[s]).attr("data-userid")){var o=a(e)[s];t.updateSingleList(a(o),t.userfavorites[i].posts)}else t.updateUserList(e[s])},t.updateSingleList=function(i,e){t.removeInvalidListItems(i,e);var s="true"===a(i).attr("data-includebuttons"),o="true"===a(i).attr("data-includelinks"),n=a(i).find("li");a.each(n,function(t,i){var e=a(this).attr("data-postid");void 0!==e&&!1!==e||a(this).remove()}),t.objectLength(e)>0?a(i).find("[data-nofavorites]").remove():(html="<li data-nofavorites>"+a(i).attr("data-nofavoritestext")+"</li>",a(i).empty().append(html));var r=a(i).attr("data-posttype");r=r.split(","),a.each(e,function(t,e){r.length>0&&-1===a.inArray(e.post_type,r)||a(i).find("li[data-postid="+e.post_id+"]").length>0||(html='<li data-postid="'+e.post_id+'">',s&&(html+="<p>"),o&&(html+='<a href="'+e.permalink+'">'),html+=e.title,o&&(html+="</a>"),s&&(html+="</p><p>"+e.button+"</p>"),html+="</li>",a(i).append(html))})},t.updateUserList=function(i){var e=a(i).attr("data-userid"),s=a(i).attr("data-siteid"),o=a(i).attr("data-includelinks"),n=a(i).attr("data-includebuttons"),r=a(i).attr("data-posttype");a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favoritelist,nonce:t.nonce,userid:e,siteid:s,includelinks:o,includebuttons:n,posttype:r},success:function(t){a(i).replaceWith(t.list)}})},t.removeInvalidListItems=function(i,e){var s=a(i).find("li[data-postid]");a.each(s,function(i,s){var o=a(this).attr("data-postid");t.isFavorite(o,e)||a(this).remove()})},t.updateTotalFavorites=function(){for(var i=0;i<a(t.total_favorites).length;i++){for(var e=a(t.total_favorites)[i],s=parseInt(a(e).attr("data-siteid")),o=a(e).attr("data-posttypes"),n=o.split(","),r=0,l=0;l<t.userfavorites.length;l++){var d=t.userfavorites[l];d.site_id===s&&a.each(d.posts,function(){if("all"===a(e).attr("data-posttypes"))return void r++;-1!==a.inArray(this.post_type,n)&&r++})}a(e).text(r)}},t.isFavorite=function(t,i){var e=!1;return a.each(i,function(a,i){i.post_id===parseInt(t)&&(e=!0),parseInt(i.post_id)===t&&(e=!0)}),e},t.isFavlist=function(t,a){return a.listids.indexOf(parseInt(t))>-1||a.listids.indexOf(""+t)>-1},t.objectLength=function(t){var a,i=0;for(a in t)t.hasOwnProperty(a)&&i++;return i},t.processFavlist=function(i){var e=void 0!==a(i).attr("data-postid")?parseInt(a(i).attr("data-postid")):null,s=void 0!==a(i).attr("data-siteid")?parseInt(a(i).attr("data-siteid")):null,o=void 0!==a(i).attr("data-listid")?parseInt(a(i).attr("data-listid")):null,n=a(i).get(0).hasAttribute("data-reloadpage")?a(i).get(0).getAttribute("data-reloadpage"):null,r=a(i).attr("data-favlistaction"),l=a(i).parents(t.overlay).length?"true":null,d=null,u=null;if(r){if(parseInt(o)>=0){if(u=a('input[type="text"][data-listtitle][data-listid="'+parseInt(o)+'"]'),u.length){if(u=u.first(),a(u).removeClass("warning"),"edit"===r)return void(u.attr("readonly")&&(u.attr("readonly",!1),u.focus().select(),a(i).attr("data-favlistaction","update_title")));"update_title"!==r||u.attr("readonly")?"create"===r&&a(u).val()==a(u).attr("data-value")&&(a(u).focus().select(),r=null):(u.attr("readonly",!0),a(i).attr("data-favlistaction","edit"),a(u).val()==a(u).attr("data-value")&&(r=null)),d=u.val()}if("delete"===r&&!confirm("Do you really want to remove the list »"+d+"«?"))return}r&&(a(i).attr("disabled","disabled"),a(i).addClass("loading"),a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favlist,nonce:t.nonce,postid:e,siteid:s,listid:o,listname:d,favlistaction:r,within_dialogue:l},success:function(e){null!==n&&("string"==typeof n?window.location.href=n:window.location.reload()),t.userfavlists=e.favorite_data.favlists||{},e.html?t.showDialogue(e.html,function(i){a(this).removeClass("loading"),a(this).attr("disabled",!1),t.updateAllFavlistButtons()}.bind(i,e)):(a(i).removeClass("loading"),a(i).attr("disabled",!1),t.updateAllFavlistButtons())}}))}},t.showDialogue=function(a,i){var e,o,n,r=document.querySelector(t.overlay);return r?e=r.querySelector(t.overlay+"__content"):(r=document.createElement("div"),r.classList.add(t.overlay.replace(/^\./,"")),document.querySelector("body").appendChild(r),o=document.createElement("div"),o.classList.add(t.overlay.replace(/^\./,"")+"__wrapper"),r.appendChild(o),n=document.createElement("span"),n.textContent="",n.classList.add(t.overlay.replace(/^\./,"")+"__close"),n.addEventListener("click",t.hideDialogue.bind(r,i)),o.appendChild(n),e=document.createElement("div"),e.classList.add(t.overlay.replace(/^\./,"")+"__content"),o.appendChild(e),window.addEventListener("keydown",s),r.classList.add("is--active")),e&&(e.innerHTML=a),t.updateAllFavlistButtons(),r},t.hideDialogue=function(a,o){var n,r=document.querySelector(t.overlay);r&&(n=i(r),n?(r.addEventListener(n,e.bind(r),!1),r.classList.remove("is--active")):e.bind(r)(),r.classList.remove("is--active"),window.removeEventListener("keydown",s),"function"==typeof a&&a())};var i=function(t){if(t){var a={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},i=null,e={transitionDuration:"transitionduration",OTransitionDuration:"oTransitionDuration",MozTransitionDuration:"transitionduration",WebkitTransitionDuration:"webkitTransitionDuration"};for(var s in a)if(void 0!==t.style[s]){i=a[s];break}if(i)for(var o in e)if(void 0!==t.style[o]){if(parseInt(t.style[o])>0)return i;break}}return null},e=function(t){var a=this;a&&a.parentElement.removeChild(a)},s=function(i){if(27===i.keyCode){var e=document.querySelector(t.overlay+" "+t.overlay+"__close");e?a(e).trigger("click"):t.hideDialogue()}};return t.init()};